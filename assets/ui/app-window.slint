import { Button, VerticalBox, HorizontalBox, ListView, LineEdit, ScrollView, Spinner } from "std-widgets.slint";

struct FileInfo {
    name: string,
    size: string,
    path: string,
    id: string,
}

export component AppWindow inherits Window {
    title: "JusTrans - File Exchange";
    min-width: 500px;
    min-height: 600px;
    max-width: 500px;
    max-height: 600px;
    background: white;
    
    // Properties
    in-out property <string> server-url: "http://192.168.1.100:8080";
    in-out property <string> qr-code-path: "";
    in-out property <[FileInfo]> files: [];
    in-out property <int> selected-file: -1;
    in-out property <bool> server-running: false;
    in-out property <string> status-message: "Server not running";
    in-out property <bool> is-loading: false;
    
    // Callbacks
    callback start-server();
    callback stop-server();
    callback add-files();
    callback remove-file(int);
    callback open-file(int);
    callback download-file(int);
    callback copy-url();
    callback refresh-files();
    callback open-url();
    
    VerticalBox {
        padding: 20px;
        spacing: 20px;
        
        // URL section
        Rectangle {
            height: 60px;
            border-width: 1px;
            border-color: #ddd;
            border-radius: 8px;
            
            HorizontalBox {
                padding: 10px;
                
                Text {
                    text: root.server-url;
                    font-size: 18px;
                    color: #0066cc;
                    font-weight: 500;
                    vertical-alignment: center;
                    horizontal-stretch: 1;
                    
                    Text {
                        x: 0;
                        y: parent.height;
                        text: "_____________________________________________________";
                        color: #0066cc;
                        font-size: 18px;
                    }
                }
            }
            
            TouchArea {
                clicked => {
                    root.open-url();
                }
            }
        }
        
        // QR Code Area
        Rectangle {
            height: 300px;
            border-width: 1px;
            border-color: #ddd;
            border-radius: 8px;
            
            if (root.server-running) : VerticalBox {
                alignment: center;
                spacing: 10px;
                
                Image {
                    source: @image-url("../qrcode/qrcode.png");
                    width: 240px;
                    height: 240px;
                    image-fit: contain;
                }
            }
            
            if (!root.server-running) : VerticalBox {
                alignment: center;
                
                Text {
                    text: "QR Code will appear here";
                    color: #888;
                    font-size: 16px;
                    horizontal-alignment: center;
                }
            }
        }
        
        // Start Button
        Rectangle {
            height: 120px;
            
            Rectangle {
                width: 120px;
                height: 120px;
                border-radius: 60px;
                border-width: 2px;
                border-color: #ddd;
                background: root.server-running ? #f44336 : #4caf50;
                x: parent.width / 2 - self.width / 2;
                y: 0;
                
                Text {
                    text: root.server-running ? "Stop" : "Start";
                    color: white;
                    font-size: 32px;
                    font-weight: 700;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }
                
                TouchArea {
                    clicked => {
                        if (root.server-running) {
                            root.stop-server();
                        } else {
                            root.start-server();
                        }
                    }
                }
            }
        }
        
        // Status text
        if (root.is-loading || root.server-running) : Text {
            text: root.status-message;
            horizontal-alignment: center;
            color: root.server-running ? #4caf50 : #f44336;
            font-size: 14px;
        }
    }
}
